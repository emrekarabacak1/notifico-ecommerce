@model IEnumerable<Notifico.Models.CartItem>

<style>
    .sidecart-item {
        background: #f8fbff;
        border: none;
        border-radius: 1rem;
        margin-bottom: 1.1rem;
        box-shadow: 0 2px 10px 0 rgba(48,80,160,0.07);
        padding: 1rem 1.2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        min-width: 250px;
    }

    .sidecart-img {
        width: 48px;
        height: 48px;
        border-radius: 0.7rem;
        object-fit: cover;
        background: #fff;
        border: 1.2px solid #e9eef6;
        margin-right: 0.7rem;
    }

    .sidecart-item-name {
        font-weight: 700;
        color: #173160;
        font-size: 1.07rem;
        letter-spacing: -0.01em;
        margin-bottom: 2px;
    }

    .sidecart-item-price {
        font-size: 0.97rem;
        color: #3676da;
        font-weight: 600;
        letter-spacing: 0.01em;
    }

    .sidecart-qty-row {
        display: flex;
        align-items: center;
        gap: 0.35rem;
        margin-top: 0.4rem;
    }

    .sidecart-btn {
        width: 28px;
        height: 28px;
        padding: 0;
        border-radius: 7px;
        font-size: 1.1rem;
        font-weight: 600;
        border: none;
        background: #eef3fb;
        color: #3e5a94;
        transition: background .15s, color .14s;
    }

        .sidecart-btn:disabled {
            opacity: 0.5;
        }

        .sidecart-btn:hover {
            background: #d9eaff;
            color: #173160;
        }

    .sidecart-remove-btn {
        color: #fff !important;
        background: #f45050;
        border-radius: 7px !important;
        margin-left: 0.25rem;
    }

        .sidecart-remove-btn:hover {
            background: #d42525;
        }

    .sidecart-total-row {
        font-size: 1.15rem;
        font-weight: 700;
        color: #122344;
        margin: 0.7rem 0 0.7rem 0;
        text-align: right;
    }

    .sidecart-action-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 1.3rem;
        gap: 0.5rem;
    }

    .sidecart-btn-clear {
        border-radius: 1.1rem;
        font-weight: 700;
        border: 1.3px solid #f8b3be;
        color: #e43d4a;
        background: #fff;
        padding: 0.5rem 1.5rem;
        transition: background .13s;
    }

        .sidecart-btn-clear:hover {
            background: #fff2f4;
            color: #af1325;
        }

    .sidecart-btn-cart {
        border-radius: 1.1rem;
        font-weight: 700;
        background: #2563eb;
        color: #fff;
        padding: 0.5rem 1.5rem;
        border: none;
        box-shadow: 0 1px 7px rgba(47,101,208,0.07);
    }

        .sidecart-btn-cart:hover {
            background: #153265;
        }
</style>

@if (Model == null || !Model.Any())
{
    <div class="alert alert-info mt-4">Sepetiniz boş.</div>
}
else
{
    <div>
        @foreach (var item in Model)
        {
            <div class="sidecart-item" data-id="@item.Id">
                <img src="@(string.IsNullOrEmpty(item.Product?.ImageUrl) ? "/images/no-image.png" : item.Product.ImageUrl)"
                     class="sidecart-img"
                     alt="@item.Product?.Name" />
                <div style="flex:1">
                    <div class="sidecart-item-name">@item.Product?.Name</div>
                    <div class="sidecart-item-price">@item.Product?.Price.ToString("C")</div>
                    <div class="sidecart-qty-row">
                        <button type="button" class="sidecart-btn btn-decrease" data-id="@item.Id" @(item.Quantity == 1 ? "disabled" : "")>-</button>
                        <span style="min-width:24px;text-align:center;font-weight:600">@item.Quantity</span>
                        <button type="button" class="sidecart-btn btn-increase" data-id="@item.Id" @(item.Product != null && item.Quantity == item.Product.Stock ? "disabled" : "")>+</button>
                        <button type="button" class="sidecart-btn sidecart-remove-btn btn-remove" data-id="@item.Id"><i class="bi bi-trash"></i></button>
                    </div>
                </div>
            </div>
        }
        <div class="sidecart-total-row">
            Toplam: <span id="sideCartTotal">@Model.Sum(x => (x.Product?.Price ?? 0) * x.Quantity).ToString("C")</span>
        </div>
        <div class="sidecart-action-row">
            <button class="sidecart-btn-clear" id="sideCartClearBtn">Sepeti Boşalt</button>
            <a href="/Cart/MyCart" class="sidecart-btn-cart">Sepete Git</a>
        </div>
    </div>
}

@section Scripts {
    <script>
        $(document).on('click', '.btn-decrease', function () {
            var id = $(this).data('id');
            $.post('/Cart/DecreaseQuantityAjax', { id: id }, function (result) {
                if (result.success) {
                    toastr.success('Ürün adedi azaltıldı');
                    reloadSideCart();
                } else {
                    toastr.error(result.error || 'İşlem başarısız');
                }
            });
        });
        $(document).on('click', '.btn-increase', function () {
            var id = $(this).data('id');
            $.post('/Cart/IncreaseQuantityAjax', { id: id }, function (result) {
                if (result.success) {
                    toastr.success('Ürün adedi artırıldı');
                    reloadSideCart();
                } else {
                    toastr.error(result.error || 'İşlem başarısız');
                }
            });
        });
        $(document).on('click', '.btn-remove', function () {
            var id = $(this).data('id');
            $.post('/Cart/RemoveFromCartAjax', { id: id }, function (result) {
                if (result.success) {
                    toastr.success('Ürün sepetten çıkarıldı');
                    reloadSideCart();
                } else {
                    toastr.error(result.error || 'İşlem başarısız');
                }
            });
        });
        $('#sideCartClearBtn').click(function () {
            $.post('/Cart/ClearCartAjax', function (result) {
                if (result.success) {
                    toastr.success('Sepet temizlendi');
                    reloadSideCart();
                } else {
                    toastr.error('İşlem başarısız');
                }
            });
        });
        function reloadSideCart() {
            $('#sideCartPartialContainer').load('/Cart/SideCartPartial');
        }
    </script>
}
